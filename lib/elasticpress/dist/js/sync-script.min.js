!function(){"use strict";var e={n:function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,{a:n}),n},d:function(t,n){for(var s in n)e.o(n,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:n[s]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t=window.wp.apiFetch,n=e.n(t),s=window.wp.date;const{epDash:o,history:c}=window,{__:r,sprintf:a}=wp.i18n,{ajax_url:i="",is_epio:l}=o,u=document.querySelector(".ep-sync-data"),p=document.querySelector(".ep-delete-data-and-sync");let d;const _=u.querySelector(".ep-sync-box__button-sync"),y=p.querySelector(".ep-delete-data-and-sync__button-delete"),x=document.querySelector(".ep-sync-data .ep-sync-box__output-tab-fulllog"),m=document.querySelector(".ep-sync-data .ep-sync-box__output-fulllog"),b=document.querySelector(".ep-sync-data .ep-sync-box__output-tab-error"),f=document.querySelector(".ep-sync-data .ep-sync-box__output-error"),S=document.querySelector(".ep-delete-data-and-sync .ep-sync-box__output-tab-fulllog"),h=document.querySelector(".ep-delete-data-and-sync .ep-sync-box__output-tab-error"),q=document.querySelector(".ep-delete-data-and-sync .ep-sync-box__output-fulllog"),g=document.querySelector(".ep-delete-data-and-sync .ep-sync-box__output-error");function v(){d=p,J(),W(y,!0),L(),I(),R(r("Deleting dataâ€¦","elasticpress"));const e=d.querySelector(".ep-sync-box__progress-info"),t=d.querySelector(".ep-sync-box__progressbar_animated"),n=d.querySelector(".ep-sync-box__start-time-date");e.innerText=r("Deleting in progress","elasticpress"),t.style.width="0",t.innerText="",n.innerText="",G(!0)}function L(){d&&(P(),w())}function T(){!function(){if(d){d.querySelector(".ep-sync-box__button-stop").style.display="none"}}(),E()}function w(){if(d){const e=d.querySelector(".ep-sync-box__button-pause");W(e,!1),e.style.display="flex"}}function E(){if(d){d.querySelector(".ep-sync-box__button-pause").style.display="none"}}function k(){if(d){const e=d.querySelector(".ep-sync-box__button-resume");W(e,!1),e.style.display="flex"}}function N(){if(d){d.querySelector(".ep-sync-box__button-resume").style.display="none"}}function P(){if(d){const e=d.querySelector(".ep-sync-box__button-stop");W(e,!1),e.style.display="flex"}}function I(){const e=d?.querySelector(".ep-sync-box__progress-wrapper");e?.style&&(e.style.display="block")}_.addEventListener("click",(function(){d=u,K(),_.style.display="none",W(_,!0);d.querySelector(".ep-sync-box__learn-more-link").style.display="none",L(),I(),R(r("Indexing dataâ€¦","elasticpress"));const e=d.querySelector(".ep-sync-box__progress-info"),t=d.querySelector(".ep-sync-box__progressbar_animated"),n=d.querySelector(".ep-sync-box__start-time-date");e.innerText=r("Sync in progress","elasticpress"),t.style.width="0",t.innerText="",n.innerText="",G()})),y.addEventListener("click",v);let A,D="sync",O=0,C=0,H=0;if($(o?.ep_last_sync_date),o.index_meta)if("cli"===o.index_meta.method){D="wpcli",O=o?.index_meta?.items_indexed,C=o?.index_meta?.total_items,d=o.index_meta.put_mapping?p:u;d.querySelector(".ep-sync-box__progress-info").innerText=r("WP-CLI sync in progress","elasticpress"),Y(o?.index_meta?.start_date_time),W(_,!0),W(y,!0),I(),F(),M()}else{if(O=o.index_meta.offset,C=o.index_meta.found_items,o.index_meta.sync_stack&&(A=o.index_meta.sync_stack),D=A&&A.length||0!==C||o.index_meta.start?"pause":"finished",d=o.index_meta?.put_mapping?p:u,J(),K(),d===u){_.style.display="none";d.querySelector(".ep-sync-box__learn-more-link").style.display="none"}k(),P(),I(),F()}else o.auto_start_index&&(v(),c.pushState({},document.title,document.location.pathname+document.location.search.replace(/&do_sync/,"")));function W(e,t){e.disabled=t}function F(){const e=d.querySelector(".ep-sync-box__progressbar_animated"),t=["initialsync","sync","pause","wpcli"].includes(D);let n;if(n=t?0===C?0:parseInt(O,10)/parseInt(C,10)*100:100,"number"===typeof n&&!Number.isNaN(n)&&Number.isFinite(n)){const t=Math.min(100,n);e.style.width=`${t}%`,e.innerText=`${Math.trunc(t)}%`}if(t)e.classList.remove("ep-sync-box__progressbar_complete");else if("interrupt"===D){d.querySelector(".ep-sync-box__progress-info").innerText=r("Sync interrupted","elasticpress"),W(y,!1),W(_,!1),T(),N(),_.style.display="flex";const e=d.querySelector(".ep-sync-box__learn-more-link");e?.style&&(e.style.display="block")}else{d.querySelector(".ep-sync-box__progress-info").innerText=r("Sync completed","elasticpress"),e.classList.add("ep-sync-box__progressbar_complete"),W(y,!1),W(_,!1),T(),N(),_.style.display="flex";const t=d.querySelector(".ep-sync-box__learn-more-link");t?.style&&(t.style.display="block")}}function j(){C=0,O=0,H=0,n()({url:i,method:"POST",body:new URLSearchParams({action:"ep_cancel_index",nonce:o.nonce})})}function M(){const e={url:i,method:"POST",body:new URLSearchParams({action:"ep_cli_index",nonce:o.nonce})};n()(e).then((e=>{if("interrupt"!==D){if("wpcli"===D){if(C=e.data?.index_meta?.total_items,O=e.data?.index_meta?.items_indexed,e.data.index_meta?.current_sync_item?.failed){const t=e.data?.message;Array.isArray(t)?t.forEach((e=>{U(e),R(e)})):"string"===typeof t&&(U(t),R(t))}else R(e.data.message);if(F(),e.data?.index_meta?.indexing)return void M()}D="finished",R("==============================="),R(r("WP-CLI sync is finished","elasticpress")),F()}}))}function R(e){if(d&&e){const t=d.querySelector(".ep-sync-box__output-wrapper"),n=d.querySelector(".ep-sync-box__output-line:last-child .ep-sync-box__output-line-number"),s=Number(n?.innerText),o=document.createElement("div");o.className="ep-sync-box__output-line-number",o.innerText="number"!==typeof s||Number.isNaN(s)?1:s+1;const c=document.createElement("div");c.className="ep-sync-box__output-line-text",c.innerText=e;const r=document.createElement("div");r.className="ep-sync-box__output-line",r.append(o),r.append(c),t.append(r);d.querySelector(".ep-sync-box__output_active").scrollTo(0,t.scrollHeight)}}function U(e){if(d){const t=d.querySelector(".ep-sync-box__output-error .ep-sync-box__output-wrapper"),n=d.querySelector(".ep-sync-box__output-error .ep-sync-box__output-line:last-child .ep-sync-box__output-line-number"),s=Number(n?.innerText),o=document.createElement("div");o.className="ep-sync-box__output-line-number",o.innerText="number"!==typeof s||Number.isNaN(s)?1:s+1;const c=document.createElement("div");c.className="ep-sync-box__output-line-text",c.innerText=e;const i=document.createElement("div");i.className="ep-sync-box__output-line",i.append(o),i.append(c),t.append(i);d.querySelector(".ep-sync-box__output-tab-error").innerText=a(r("Errors (%d)","elasticpress"),o.innerText);d.querySelector(".ep-sync-box__output-error").scrollTo(0,t.scrollHeight)}}function Y(e){if(e){const t=d.querySelector(".ep-sync-box__start-time-date");t&&(t.innerText=(0,s.dateI18n)(r("D, F d, Y H:i","elasticpress"),e))}}function $(e){if(e){const t=document.querySelector(".ep-last-sync__date");t&&(t.innerText=(0,s.dateI18n)(r("D, F d, Y H:i","elasticpress"),e))}}function z(e){if(!e)return;D="interrupt";let t=r("Sync interrupted by WP-CLI command","elasticpress");d===p&&(t=a(r("Your indexing process has been stopped by WP-CLI and your %s index could be missing content. To restart indexing, please click the Start button or use WP-CLI commands to perform the reindex. Please note that search results could be incorrect or incomplete until the reindex finishes.","elasticpress"),l?"ElasticPress.io":"Elasticsearch")),Q(r("Sync interrupted","elasticpress"),t)}function B(e=!1){const t={url:i,method:"POST",body:new URLSearchParams({action:"ep_index",put_mapping:e?1:0,nonce:o.nonce})};n()(t).then((t=>{if(t.data.index_meta?.current_sync_item?.failed){const e=t.data?.message;Array.isArray(e)?e.forEach((e=>{U(e),R(e)})):"string"===typeof e&&(U(e),R(e))}else R(t.data.message);if(Y(t?.data?.index_meta?.start_date_time),z(t.data?.index_meta?.should_interrupt_sync),"cli"===t.data?.method)return D="wpcli",void M();if("sync"===D){if(!t.data.index_meta){D="finished";const e=document.querySelector(".ep-last-sync__icon-status"),n=document.querySelector(".ep-last-sync__status");return e.src=t.data.totals.failed?e.src?.replace(/thumbsup/,"thumbsdown"):e.src?.replace(/thumbsdown/,"thumbsup"),n.innerText=t.data.totals.failed?r("Sync unsuccessful on ","elasticpress"):r("Sync success on ","elasticpress"),$(t.data?.totals?.end_date_time),F(),R("==============================="),o.install_sync&&document.location.replace(o.install_complete_url),d=void 0,O=0,C=0,void(H=0)}C||(C=t.data?.index_meta?.current_sync_item?.found_items,t.data?.index_meta?.sync_stack&&(A=t.data.index_meta.sync_stack,C=A?.reduce(((e,t)=>e+t.found_items),C))),0===t.data.index_meta.offset&&O>0&&(H=O),O=H+t.data.index_meta.offset,F(),B(e)}})).catch((e=>{e&&e.status&&parseInt(e.status,10)>=400&&parseInt(e.status,10)<600&&(D="error",F(),j()),W(_,!1),W(y,!1)}))}function G(e){D="initialsync";const t=d.querySelector(".ep-sync-box__progress-wrapper"),n=d.querySelector(".ep-sync-box__progress-info"),s=d.querySelector(".ep-sync-box__progressbar_animated"),o=d.querySelector(".ep-sync-box__start-time-date");t.style.display="block",n.innerText=r("Sync in progress","elasticpress"),s.style.width="0",s.innerText="",o.innerText="",F(),D="sync",B(e)}function J(){u.querySelectorAll(".ep-sync-data button").forEach((e=>W(e,!0)))}function K(){p.querySelectorAll(".ep-delete-data-and-sync button").forEach((e=>W(e,!0)))}function Q(e,t){D="wpcli"===D?"interrupt":"cancel";const n=d.querySelector(".ep-sync-box__progress-info"),s=d.querySelector(".ep-sync-box__progressbar_animated");F(),j(),n.innerText=e,s.style.width="0",s.innerText="",R(t)}document.querySelectorAll(".ep-sync-box__button-pause")?.forEach((e=>{e?.addEventListener("click",(function(){D="pause";const e=d?.querySelector(".ep-sync-box__progress-info");e?.innerText&&(e.innerText=r("Sync paused","elasticpress")),F(),E(),k(),R(r("Sync paused","elasticpress"))}))})),document.querySelectorAll(".ep-sync-box__button-resume")?.forEach((e=>{e?.addEventListener("click",(function(){D="sync";d.querySelector(".ep-sync-box__progress-info").innerText=r("Sync in progress","elasticpress"),F(),N(),w(),B()}))})),document.querySelectorAll(".ep-sync-box__button-stop")?.forEach((e=>{e?.addEventListener("click",(()=>{Q(r("Sync stopped","elasticpress"),r("Sync stopped","elasticpress"))}))})),document.querySelectorAll(".ep-sync-box__show-hide-log")?.forEach((e=>{e.addEventListener("click",(function(t){t.preventDefault(),e.nextElementSibling?.classList?.toggle("ep-sync-box__output-tabs_hide")?e.innerText=r("Show log","elasticpress"):e.innerText=r("Hide log","elasticpress")}))})),x.addEventListener("click",(function(){x.classList.add("ep-sync-box__output-tab_active"),m.classList.add("ep-sync-box__output_active"),b.classList.remove("ep-sync-box__output-tab_active"),f.classList.remove("ep-sync-box__output_active")})),b.addEventListener("click",(function(){b.classList.add("ep-sync-box__output-tab_active"),f.classList.add("ep-sync-box__output_active"),x.classList.remove("ep-sync-box__output-tab_active"),m.classList.remove("ep-sync-box__output_active")})),S.addEventListener("click",(function(){S.classList.add("ep-sync-box__output-tab_active"),q.classList.add("ep-sync-box__output_active"),h.classList.remove("ep-sync-box__output-tab_active"),g.classList.remove("ep-sync-box__output_active")})),h.addEventListener("click",(function(){h.classList.add("ep-sync-box__output-tab_active"),g.classList.add("ep-sync-box__output_active"),S.classList.remove("ep-sync-box__output-tab_active"),q.classList.remove("ep-sync-box__output_active")}))}();